name: Tests

on:
  push:
  workflow_dispatch:
permissions:
  contents: read

jobs:
  indexer:

      runs-on: ubuntu-latest
      steps:
          - uses: actions/checkout@v3
          - uses: actions/setup-python@v4
            with:
              python-version: '3.10' 
          
          
          - id: 'auth'
            name: 'Authenticate to Google Cloud'
            uses: 'google-github-actions/auth@v1'
            with:
              credentials_json: '${{ secrets.GCP_CREDENTIALS }}'
              export_environment_variables: true
          
          - name: 'Set up Cloud SDK'
            uses: 'google-github-actions/setup-gcloud@v1'
          
          - name: 'Indexer Tests'
            run: python3 packages/cli/cli/main.py test indexer

          
  parse:
      runs-on: ubuntu-latest
      steps:
          - uses: actions/checkout@v3

          - uses: actions/setup-python@v4
            with:
              python-version: '3.10'  
          
          - name: "install cli dependencies"
            run: 
              pip install poetry && cd packages/cli && poetry install && cd ../..

          - name: 'Parse Tests'
            run: python3 packages/cli/cli/main.py test parse
