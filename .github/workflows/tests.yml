name: Indexer Tests

on:
  push:
  workflow_dispatch:
permissions:
  contents: read

jobs:
  indexer:

      runs-on: ubuntu-latest
      steps:
          - uses: actions/checkout@v3
          
          
          - id: 'auth'
            name: 'Authenticate to Google Cloud'
            uses: 'google-github-actions/auth@v1'
            with:
              credentials_json: '${{ secrets.GCP_CREDENTIALS }}'
              export_environment_variables: true
          
          - name: 'Set up Cloud SDK'
            uses: 'google-github-actions/setup-gcloud@v1'


          - name: Docker Compose Run Tests
            working-directory: packages/indexer
            run: docker compose -f docker-compose.tests.yaml run indexer-test